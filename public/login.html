<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexus Club - Connexion Admin</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="styles.css" />
  </head>

  <body class="bg-gray-900 text-white">
    <section
      class="hero relative py-4 text-center bg-gradient-to-br from-gray-800 to-gray-900 px-4"
    >
      <div class="mb-4 flex items-center justify-center">
        <img
          src="/assets/logo nexus 1.svg"
          alt="Logo Nexus Club"
          class="h-12 md:h-16"
        />
      </div>
      <div class="max-w-3xl mx-auto">
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold mb-4">
          Connexion Admin
        </h1>
        <p class="text-sm mb-8">
          Connectez-vous avec votre nom d'utilisateur et mot de passe pour
          accéder au dashboard.
        </p>
        <form id="adminLoginForm" class="space-y-4 max-w-md mx-auto">
          <input
            type="text"
            name="username"
            placeholder="Nom d'utilisateur"
            required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-400"
          />
          <input
            type="password"
            name="password"
            placeholder="Mot de passe"
            required
            class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-400"
          />
          <button
            type="submit"
            class="w-full bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-md transition"
          >
            Se connecter
          </button>
          <!-- Zone d'affichage du message d'erreur -->
          <div id="errorMessage" class="text-red-500 text-center mt-2"></div>
        </form>
      </div>
    </section>
    <footer class="py-4 text-center bg-gray-800">
      <p class="text-sm text-gray-500">
        &copy; 2025 Nexus Club. Tous droits réservés.
      </p>
    </footer>

    <script>
      document
        .getElementById("adminLoginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const form = e.target;
          const formData = new FormData(form);
          const username = formData.get("username");
          const password = formData.get("password");

          fetch("/admin/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          })
            .then(async (response) => {
              const result = await response.json();
              if (!response.ok || !result.success) {
                //affiche le message d'erreur directement sur la page
                document.getElementById("errorMessage").innerText =
                  result.message || "Erreur lors de la connexion.";
              } else {
                //en cas de succès, rediriger vers admin.html en passant les infos dans l'URL
                const admin = result.admin;
                window.location.href = `/admin.html?username=${encodeURIComponent(
                  admin.username
                )}&fullName=${encodeURIComponent(
                  admin.fullName
                )}&role=${encodeURIComponent(admin.role)}`;
              }
            })
            .catch((err) => {
              console.error(err);
              document.getElementById("errorMessage").innerText =
                "Erreur lors de la connexion.";
            });
        });
    </script>
  </body>
</html>
